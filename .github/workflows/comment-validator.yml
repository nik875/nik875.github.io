name: Validate comment length

on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created, edited]

permissions:
  issues: write
  contents: read

jobs:
  validate-comment:
    runs-on: ubuntu-latest
    steps:
      - name: Check comment length
        uses: actions/github-script@v7
        with:
          script: |
            const minLength = 300;
            let content = '';
            let isComment = false;
            
            // Get the content to check
            if (context.payload.issue) {
              content = context.payload.issue.body || '';
              isComment = false;
            }
            if (context.payload.comment) {
              content = context.payload.comment.body || '';
              isComment = true;
            }
            
            // Count characters (excluding whitespace)
            const charCount = content.trim().length;
            
            if (charCount < minLength) {
              // Post reply
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: 'Your comment was flagged as too short and will be automatically deleted. Please elaborate further on your thoughts, I want to hear what you have to say!'
              });
              
              // Close issue
              await github.rest.issues.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                state: 'closed',
                state_reason: 'not_planned'
              });
              
              // Delete issue
              await github.rest.issues.deleteIssue({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number
              });
              
              console.log(`Deleted issue #${context.issue.number} - too short (${charCount} characters)`);
            }
