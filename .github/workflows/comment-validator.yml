name: Validate comment length

on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created, edited]

permissions:
  issues: write
  contents: read

jobs:
  validate-comment:
    runs-on: ubuntu-latest
    steps:
      - name: Check comment length
        uses: actions/github-script@v7
        with:
          script: |
            const minLength = 300;
            let content = '';
            let commentId = null;
            
            // Get the content to check
            if (context.payload.issue) {
              content = context.payload.issue.body || '';
            }
            if (context.payload.comment) {
              content = context.payload.comment.body || '';
              commentId = context.payload.comment.id;
            }
            
            // Count characters (excluding whitespace)
            const charCount = content.trim().length;
            
            if (charCount < minLength) {
              // Post warning reply
              const reply = await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: 'Your comment was flagged as too short and will be automatically deleted. Please elaborate further on your thoughts, I want to hear what you have to say!'
              });
              
              // Delete the short comment if it's a reply comment
              if (commentId) {
                await github.rest.issues.deleteComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  comment_id: commentId
                });
              } else {
                // If it's the issue body, close the issue
                await github.rest.issues.update({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.issue.number,
                  state: 'closed',
                  state_reason: 'not_planned'
                });
              }
              
              console.log(`Deleted comment - too short (${charCount} characters)`);
            }
