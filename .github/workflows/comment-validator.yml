name: Validate comment length

on:
  issue_comment:
    types: [created, edited]

permissions:
  issues: write
  contents: read

jobs:
  validate-comment:
    runs-on: ubuntu-latest
    steps:
      - name: Check comment length
        uses: actions/github-script@v7
        with:
          script: |
            const minLength = 300;
            const comment = context.payload.comment;
            const commentAuthor = comment.user.login;
            
            // Skip if comment is from bot
            if (commentAuthor === 'utterances-bot' || commentAuthor === 'github-actions') {
              console.log('Skipping bot comment');
              return;
            }
            
            // Count characters (excluding whitespace)
            const charCount = comment.body.trim().length;
            
            console.log(`Comment from ${commentAuthor}: ${charCount} characters`);
            
            if (charCount < minLength) {
              // Post notification
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: 'This comment was flagged as too short and has been removed. Comments have a minimum character limit of 300 to encourage meaningful discussion. Please elaborate on your thoughts, I want to hear what you have to say!'
              });
              
              // Delete the user's short comment
              await github.rest.issues.deleteComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                comment_id: comment.id
              });
              
              console.log(`Deleted comment #${comment.id} - too short (${charCount} characters)`);
            }
